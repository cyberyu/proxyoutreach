<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Page Blocking Test - Complete Implementation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        /* Simple Full-Screen Blocking Overlay */
        .page-blocker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(240, 240, 240, 0.95);
            z-index: 99999;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            cursor: wait;
        }

        .page-blocker.active {
            display: flex;
        }

        /* Page Blocker Content Container */
        .page-blocker-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Spinning Clock Icon */
        .loading-clock {
            font-size: 4rem;
            color: #6c757d;
            animation: clock-spin 2s linear infinite;
            margin-bottom: 1.5rem;
        }

        @keyframes clock-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Loading Message */
        .loading-message {
            font-size: 1.2rem;
            color: #495057;
            font-weight: 500;
            text-align: center;
            max-width: 400px;
            line-height: 1.5;
        }

        /* Disable page content when loading */
        body.loading-active {
            pointer-events: none;
            user-select: none;
        }

        body.loading-active * {
            cursor: wait !important;
        }

        /* Keep the blocker interactive */
        .page-blocker {
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <!-- Page Blocker Overlay -->
    <div id="pageBlocker" class="page-blocker">
        <div class="page-blocker-content">
            <div class="loading-clock">
                <i class="fas fa-clock"></i>
            </div>
            <div id="loadingMessage" class="loading-message">Loading data...</div>
        </div>
    </div>

    <div class="container-fluid">
        <h1 class="my-4">Simple Page Blocking Test - Complete Implementation</h1>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Updated Implementation:</strong> This page demonstrates the simple page blocking approach you requested - 
            "grey out/disable entire browser with spinning clock until data loaded completely"
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-test-tube me-2"></i>Test Simple Page Blocking</h5>
                    </div>
                    <div class="card-body">
                        <p>Click the buttons below to test the simple page blocking functionality:</p>
                        
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="testShortLoading()">
                                <i class="fas fa-clock me-2"></i>Test Short Loading (2 seconds)
                            </button>
                            
                            <button class="btn btn-warning" onclick="testMediumLoading()">
                                <i class="fas fa-clock me-2"></i>Test Medium Loading (5 seconds)
                            </button>
                            
                            <button class="btn btn-danger" onclick="testLongLoading()">
                                <i class="fas fa-clock me-2"></i>Test Long Loading (10 seconds)
                            </button>
                            
                            <button class="btn btn-info" onclick="testFakeDataLoading()">
                                <i class="fas fa-database me-2"></i>Test Fake Dashboard Loading
                            </button>
                        </div>
                        
                        <hr>
                        
                        <h6>Manual Controls:</h6>
                        <div class="btn-group" role="group">
                            <button class="btn btn-success btn-sm" onclick="blockPage('Manually blocked page')">
                                <i class="fas fa-lock me-1"></i>Block Page
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="unblockPage()">
                                <i class="fas fa-unlock me-1"></i>Unblock Page
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-info-circle me-2"></i>Test Data Display</h5>
                    </div>
                    <div class="card-body">
                        <div id="dataDisplay" class="border rounded p-3 bg-light">
                            <p class="text-muted">No data loaded yet. Click a test button to see data loading behavior.</p>
                        </div>
                        
                        <div class="mt-3">
                            <small class="text-muted">
                                <strong>Expected Behavior:</strong><br>
                                â€¢ Page becomes completely unclickable during loading<br>
                                â€¢ Spinning clock icon displays in center<br>
                                â€¢ All interactions are blocked until loading completes<br>
                                â€¢ User cannot navigate or interact with any elements<br>
                                â€¢ Simple and effective - no complex progress indicators
                            </small>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h5><i class="fas fa-mouse-pointer me-2"></i>Try These During Loading</h5>
                    </div>
                    <div class="card-body">
                        <p>These should be completely blocked during loading:</p>
                        
                        <button class="btn btn-outline-primary me-2" onclick="alert('Button clicked!')">
                            Click Me
                        </button>
                        
                        <button class="btn btn-outline-secondary me-2" onclick="window.open('https://google.com', '_blank')">
                            Open Google
                        </button>
                        
                        <input type="text" class="form-control mt-2" placeholder="Try typing here during loading...">
                        
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="testCheckbox">
                            <label class="form-check-label" for="testCheckbox">
                                Try checking this during loading
                            </label>
                        </div>
                        
                        <select class="form-select mt-2">
                            <option>Try changing this dropdown</option>
                            <option>Option 1</option>
                            <option>Option 2</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // === SIMPLE PAGE BLOCKING SYSTEM ===
        // Complete page blocking with spinning clock until data loads
        class SimplePageBlocker {
            constructor() {
                this.blocker = document.getElementById('pageBlocker');
                this.message = document.getElementById('loadingMessage');
                this.isBlocking = false;
                this.init();
            }
            
            init() {
                // Block all interactions during loading
                document.addEventListener('click', (e) => {
                    if (this.isBlocking && !e.target.closest('#pageBlocker')) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ðŸš« Click blocked during loading');
                        return false;
                    }
                }, true);
                
                // Block form submissions during loading
                document.addEventListener('submit', (e) => {
                    if (this.isBlocking) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ðŸš« Form submission blocked during loading');
                        return false;
                    }
                }, true);
                
                // Block keyboard input during loading
                document.addEventListener('keydown', (e) => {
                    if (this.isBlocking) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ðŸš« Keyboard input blocked during loading');
                        return false;
                    }
                }, true);
                
                // Block navigation during loading
                window.addEventListener('beforeunload', (e) => {
                    if (this.isBlocking) {
                        e.preventDefault();
                        e.returnValue = 'Data is still loading. Are you sure you want to leave?';
                        return e.returnValue;
                    }
                });
            }

            // Block the entire page
            block(message = 'Loading data...') {
                if (this.isBlocking) return;
                
                this.isBlocking = true;
                this.updateMessage(message);
                
                // Add loading class to body (disables all interactions)
                document.body.classList.add('loading-active');
                
                // Show blocker overlay
                if (this.blocker) {
                    this.blocker.classList.add('active');
                }
                
                console.log('ðŸ”’ Page blocked for loading:', message);
            }

            // Unblock the page
            unblock() {
                if (!this.isBlocking) return;
                
                this.isBlocking = false;
                
                // Remove loading class from body (re-enables interactions)
                document.body.classList.remove('loading-active');
                
                // Hide blocker overlay
                if (this.blocker) {
                    this.blocker.classList.remove('active');
                }
                
                console.log('ðŸ”“ Page unblocked - loading complete');
            }

            // Update loading message
            updateMessage(message) {
                if (this.message) {
                    this.message.innerHTML = message + '<br><small class="text-muted">Please wait, the page will be available when complete</small>';
                }
            }

            // Check if currently blocking
            isActive() {
                return this.isBlocking;
            }
        }

        // Initialize the simple page blocker
        const pageBlocker = new SimplePageBlocker();

        // Global functions for easy integration
        window.blockPage = function(message) {
            pageBlocker.block(message);
        };

        window.unblockPage = function() {
            pageBlocker.unblock();
        };

        window.isPageBlocked = function() {
            return pageBlocker.isActive();
        };

        // Test functions
        function testShortLoading() {
            blockPage('Loading data (2 seconds)...');
            
            setTimeout(() => {
                document.getElementById('dataDisplay').innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Short Loading Complete!</strong><br>
                        Loaded at: ${new Date().toLocaleTimeString()}
                    </div>
                `;
                unblockPage();
            }, 2000);
        }

        function testMediumLoading() {
            blockPage('Loading proposals and dashboard data (5 seconds)...');
            
            setTimeout(() => {
                document.getElementById('dataDisplay').innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-clock me-2"></i>
                        <strong>Medium Loading Complete!</strong><br>
                        Loaded at: ${new Date().toLocaleTimeString()}
                    </div>
                `;
                unblockPage();
            }, 5000);
        }

        function testLongLoading() {
            blockPage('Loading complete database results (10 seconds)...');
            
            setTimeout(() => {
                document.getElementById('dataDisplay').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-hourglass-end me-2"></i>
                        <strong>Long Loading Complete!</strong><br>
                        Loaded at: ${new Date().toLocaleTimeString()}
                    </div>
                `;
                unblockPage();
            }, 10000);
        }

        function testFakeDataLoading() {
            blockPage('Loading dashboard statistics and proposal data...');
            
            // Simulate the real application loading process
            setTimeout(() => {
                pageBlocker.updateMessage('Fetching dashboard data from database...');
            }, 1000);
            
            setTimeout(() => {
                pageBlocker.updateMessage('Loading proposals table...');
            }, 2500);
            
            setTimeout(() => {
                pageBlocker.updateMessage('Processing outreach accounts...');
            }, 4000);
            
            setTimeout(() => {
                pageBlocker.updateMessage('Finalizing results...');
            }, 5500);
            
            setTimeout(() => {
                // Show final data that mimics the real application
                document.getElementById('dataDisplay').innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-database me-2"></i>
                        <strong>Dashboard Loading Complete!</strong><br>
                        <div class="row mt-2">
                            <div class="col-6">
                                <small><strong>Total Proposals:</strong> 1,234</small><br>
                                <small><strong>Voted Accounts:</strong> 789</small><br>
                            </div>
                            <div class="col-6">
                                <small><strong>Unvoted Accounts:</strong> 445</small><br>
                                <small><strong>Accuracy Rate:</strong> 87.3%</small><br>
                            </div>
                        </div>
                        <small class="text-muted">Completed at: ${new Date().toLocaleTimeString()}</small>
                    </div>
                `;
                unblockPage();
            }, 6500);
        }

        // Show initial message
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Simple Page Blocking Test loaded successfully');
            console.log('Available functions: blockPage(), unblockPage(), isPageBlocked()');
            
            // Add some visual feedback in the console
            console.log('%cðŸ”§ Simple Page Blocking System Ready', 'color: green; font-weight: bold;');
            console.log('This replaces the complex LoadingManager with a simple but effective approach');
        });
    </script>
</body>
</html>
